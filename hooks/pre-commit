#!/bin/bash
#
# Pre-commit hook that runs quality check using AI agent
#

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
# Get the git repository root
REPO_ROOT="$(git rev-parse --show-toplevel)"

# Path to the Python script
PYTHON_SCRIPT="$REPO_ROOT/.git-hooks/pre_commit_check.py"

# Check if Python script exists
if [ ! -f "$PYTHON_SCRIPT" ]; then
    echo "‚ùå Error: Pre-commit script not found at $PYTHON_SCRIPT"
    exit 1
fi

# Make sure the Python script is executable
chmod +x "$PYTHON_SCRIPT"

# Run the Python script
echo "Executing pre-commit quality check..."
python3 "$PYTHON_SCRIPT"
exit_code=$?

if [ $exit_code -ne 0 ]; then
    echo ""
    echo "Pre-commit hook failed with exit code $exit_code"
    echo "üí° Fix the issues above and try committing again."
    exit $exit_code
fi

echo ""
echo "Pre-commit hook completed successfully!"
exit 0 