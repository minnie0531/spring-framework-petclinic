#!/bin/bash
#
# Commit message hook that enhances commit messages using AI agent
#

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
# Get the git repository root
REPO_ROOT="$(git rev-parse --show-toplevel)"

# Path to the Python script
PYTHON_SCRIPT="$REPO_ROOT/.git-hooks/commit_msg_generator.py"

# Check if Python script exists
if [ ! -f "$PYTHON_SCRIPT" ]; then
    echo "Error: Commit message script not found at $PYTHON_SCRIPT"
    exit 1
fi

# Make sure the Python script is executable
chmod +x "$PYTHON_SCRIPT"

# Get the commit message file path (passed as first argument)
COMMIT_MSG_FILE="$1"

if [ -z "$COMMIT_MSG_FILE" ]; then
    echo "Error: No commit message file provided"
    exit 1
fi

# Run the Python script with the commit message file
echo "ðŸ”„ Executing commit message enhancement..."
python3 "$PYTHON_SCRIPT" "$COMMIT_MSG_FILE"
exit_code=$?

if [ $exit_code -ne 0 ]; then
    echo ""
    echo "Commit message hook failed with exit code $exit_code"
    exit $exit_code
fi

echo ""
echo "âœ… Commit message enhancement completed!"
exit 0 